name: manage docker repository tag based on branch
description: custom local action for docker images

inputs:
  gitref:
    description: 'git ref triggering the workflow'
    required: true

outputs:
  tag:
    description: "Tag string"
    value: ${{ steps.rules.outputs.tag }}
  push:
    description: "Boolean to push"
    value: ${{ steps.rules.outputs.tag }}

runs:
  using: "composite"
  steps:
    - name: "Tag rule"
      shell: bash
      id: rules
      run: |
        echo "::set-output name=push::true";
        echo "${EVENT_REF}"
        case "${EVENT_REF}" in
          refs/heads/develop|develop)
            echo "::set-output name=tag::dev";
          ;;
          refs/heads/release-*|release-*|refs/tags/v*.*.*-beta|v*.*.*-beta)
            echo "::set-output name=tag::next";
          ;;
          refs/heads/devops|devops)
            echo "::set-output name=tag::devops";
          ;;
          refs/tags/v*.*.*|v*.*.*)
            echo "::set-output name=tag::latest";
          ;;
          *)
            echo "::set-output name=tag::none";
            echo "::set-output name=push::false";
          ;;
        esac
      env:
        EVENT_REF: ${{ inputs.gitref }}